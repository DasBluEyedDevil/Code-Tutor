---
phase: 04-csharp-course-audit
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - content/courses/csharp/modules/16-building-cloud-native-apps-with-net-aspire/**/*.md
  - content/courses/csharp/modules/17-native-aot-and-performance-optimization/**/*.md
  - content/courses/csharp/modules/18-clean-architecture/**/*.md
  - content/courses/csharp/modules/19-modern-api-development-with-openapi-scalar/**/*.md
  - content/courses/csharp/modules/20-authentication-fundamentals/**/*.md
  - content/courses/csharp/modules/21-external-authentication-providers/**/*.md
  - content/courses/csharp/modules/22-authorization-patterns/**/*.md
  - content/courses/csharp/modules/23-cicd-with-github-actions/**/*.md
  - content/courses/csharp/modules/24-capstone-completion-shopflow-launch/**/*.md
  - content/courses/csharp/capstone/**/*.cs (read-only review)
  - content/courses/csharp/capstone/**/*.csproj (read-only review)
autonomous: true

must_haves:
  truths:
    - "Module 19 OpenAPI content accurately describes .NET 9 built-in OpenAPI (MapOpenApi, AddOpenApi)"
    - ".NET Aspire Advanced (M16) patterns are valid for Aspire 9.x"
    - "Native AOT (M17) content is accurate for .NET 9 AOT compilation"
    - "Clean Architecture (M18) patterns use .NET 9 project structure (net9.0)"
    - "Authentication (M20) uses ASP.NET Core Identity for .NET 9"
    - "OAuth/OIDC (M21) patterns are current"
    - "Authorization (M22) uses policy-based authorization (current pattern)"
    - "CI/CD (M23) GitHub Actions workflows target .NET 9"
    - "Capstone (M24) ShopFlow instructions are complete and reference all prior modules"
    - "Missing WARNING sections added to M18, M22, M23, M24 where natural pitfalls exist"
  artifacts:
    - path: ".planning/phases/04-csharp-course-audit/04-04-SUMMARY.md"
      provides: "Accuracy pass results for Modules 16-24"
  key_links:
    - from: "Module 19 OpenAPI content"
      to: ".NET 9 built-in OpenAPI"
      via: "Framework accuracy"
      pattern: "AddOpenApi|MapOpenApi|Scalar"
    - from: "Module 23 CI/CD workflows"
      to: ".NET 9 SDK in GitHub Actions"
      via: "Build pipeline accuracy"
      pattern: "dotnet-version|net9\\.0|actions/setup-dotnet"
    - from: "Module 24 capstone"
      to: "ShopFlow project structure"
      via: "Capstone completeness"
      pattern: "ShopFlow|capstone"
---

<objective>
Accuracy pass across Modules 16-24 (42 lessons, ~175 content files): verify advanced .NET topics (Aspire, AOT, Clean Architecture, OpenAPI, Auth, CI/CD) and the ShopFlow capstone against .NET 9 / C# 13. Add missing WARNING sections to modules with gaps. Verify capstone lesson content matches the actual ShopFlow project structure.

Purpose: Modules 16-24 cover advanced topics and the culminating capstone. These modules reference the most specialized .NET 9 features (Native AOT, built-in OpenAPI, Aspire advanced patterns) and are where version drift is most likely. The capstone must reference actual project structure so students can follow along.

Output: Corrected content across 9 modules with advanced feature accuracy verified, WARNING gaps closed, and capstone content aligned with ShopFlow project.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-csharp-course-audit/04-RESEARCH.md
@.planning/phases/04-csharp-course-audit/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Accuracy pass Modules 16-19 (Aspire Advanced, AOT, Architecture, Modern APIs)</name>
  <files>
    content/courses/csharp/modules/16-building-cloud-native-apps-with-net-aspire/**/*.md
    content/courses/csharp/modules/17-native-aot-and-performance-optimization/**/*.md
    content/courses/csharp/modules/18-clean-architecture/**/*.md
    content/courses/csharp/modules/19-modern-api-development-with-openapi-scalar/**/*.md
  </files>
  <action>
    Read every content file in Modules 16-19 (19 lessons). For each lesson, verify:

    **1. Module 16 (.NET Aspire Advanced, 5 lessons):**
    - Aspire 9.x patterns: service discovery, OpenTelemetry integration, Polly resilience
    - `builder.AddProject<>()` and resource orchestration syntax current
    - If Aspire version is mentioned, should say "9.x" (note: Aspire 13.0 exists for .NET 10 but is out of scope)
    - Health checks and monitoring patterns current
    - Do NOT update to Aspire 13.0 patterns -- course targets .NET 9

    **2. Module 17 (Native AOT, 5 lessons):**
    - PublishAot in .csproj correctly shown (`<PublishAot>true</PublishAot>`)
    - AOT limitations accurately described (no reflection-based serialization, trimming warnings)
    - Source generators as AOT-compatible alternative to reflection
    - BenchmarkDotNet patterns current
    - .NET 9 AOT improvements described if content references them (better trimming, smaller binaries)
    - References to ".NET 9" should be current and accurate

    **3. Module 18 (Clean Architecture, 4 lessons):**
    - Four-layer pattern: Domain, Application, Infrastructure, Presentation
    - Project references (.csproj) should target net9.0
    - Dependency rule (inner layers don't reference outer) correctly explained
    - MediatR / CQRS patterns current (if mentioned)
    - Domain-driven design basics accurate

    **4. Module 19 (OpenAPI/Scalar, 5 lessons) -- CRITICAL:**
    - **Built-in OpenAPI is a .NET 9 feature**: `builder.Services.AddOpenApi()` and `app.MapOpenApi()`
    - This replaces Swashbuckle (which was removed from .NET 9 templates)
    - Scalar UI as an alternative to Swagger UI
    - API versioning patterns current (Asp.Versioning.Http)
    - Kiota for API client generation -- verify it's described accurately
    - Lesson titles mentioning ".NET 9" are correct and should stay

    **5. Add WARNING sections where missing:**
    - Module 18: 3/4 lessons missing WARNING. Add where natural:
      - Over-engineering for small projects (Clean Architecture is overkill for simple APIs)
      - Layer coupling through shared DTOs
      - Infrastructure layer becoming a dumping ground
    - No WARNING gaps in M16, M17, M19 per research

    **6. Version reference sweep:**
    - .csproj examples should show net9.0 target framework
    - CI/CD snippets (if any) should reference .NET 9 SDK
    - Replace any stale ".NET 8" references with ".NET 9" (except historical context)

    Commit: "fix(04-04): accuracy pass M16-19 -- Aspire 9.x, AOT, Clean Architecture, OpenAPI .NET 9"
  </action>
  <verify>
    - Module 19 correctly describes built-in OpenAPI as .NET 9 feature
    - Module 16 references Aspire 9.x (not generic/versionless)
    - Module 17 AOT patterns match .NET 9 capabilities
    - Module 18 .csproj examples target net9.0
    - `grep -r "net8\.0" content/courses/csharp/modules/{16,17,18,19}-*/ --include="*.md" | grep -v "introduced\|legacy\|historical" | head -20` returns minimal results
    - WARNING sections added to M18 where natural
  </verify>
  <done>Modules 16-19 verified. Aspire, AOT, Clean Architecture, and OpenAPI content current for .NET 9. Module 18 WARNING gap addressed.</done>
</task>

<task type="auto">
  <name>Task 2: Accuracy pass Modules 20-24 (Auth, CI/CD, Capstone)</name>
  <files>
    content/courses/csharp/modules/20-authentication-fundamentals/**/*.md
    content/courses/csharp/modules/21-external-authentication-providers/**/*.md
    content/courses/csharp/modules/22-authorization-patterns/**/*.md
    content/courses/csharp/modules/23-cicd-with-github-actions/**/*.md
    content/courses/csharp/modules/24-capstone-completion-shopflow-launch/**/*.md
    content/courses/csharp/capstone/ (read-only project structure review)
  </files>
  <action>
    Read every content file in Modules 20-24 (23 lessons). For each lesson, verify:

    **1. Module 20 (Authentication, 5 lessons):**
    - ASP.NET Core Identity patterns for .NET 9
    - JWT authentication with `Microsoft.AspNetCore.Authentication.JwtBearer`
    - Token generation with `System.IdentityModel.Tokens.Jwt` or `Microsoft.IdentityModel.JsonWebTokens`
    - Refresh token patterns current
    - Password hashing uses Identity's built-in hasher (not custom BCrypt unless teaching concepts)

    **2. Module 21 (External Auth, 4 lessons):**
    - OAuth 2.0 / OpenID Connect flow accurately described
    - Google, Microsoft, GitHub sign-in via `AddAuthentication().AddGoogle()` etc.
    - External auth package references current for .NET 9
    - Callback URL configuration correct

    **3. Module 22 (Authorization, 4 lessons):**
    - Role-based authorization: `[Authorize(Roles = "Admin")]` pattern
    - Claims-based authorization current
    - Policy-based authorization: `builder.Services.AddAuthorizationBuilder()` (.NET 8+ pattern, current in .NET 9)
    - Resource-based authorization with IAuthorizationHandler
    - `AddAuthorizationBuilder()` is the modern API (replaces `AddAuthorization(options => ...)` for policy config)

    **4. Module 23 (CI/CD, 5 lessons):**
    - GitHub Actions workflow syntax current (uses/checkout@v4, setup-dotnet@v4)
    - `dotnet-version: '9.0.x'` in setup-dotnet (not 8.0.x)
    - Docker image: `mcr.microsoft.com/dotnet/aspnet:9.0` and `mcr.microsoft.com/dotnet/sdk:9.0`
    - Multi-stage Docker build pattern current
    - Environment variables and secrets management current
    - Deployment targets (Azure App Service, container apps) current

    **5. Module 24 (Capstone ShopFlow, 5 lessons) -- CRITICAL:**
    - Read the actual capstone project structure (C:/Users/dasbl/Downloads/Code-Tutor/content/courses/csharp/capstone/)
    - Verify lesson content matches actual project structure:
      - ShopFlow.Api, ShopFlow.Application, ShopFlow.Core, ShopFlow.Domain, ShopFlow.Infrastructure
      - ShopFlow.Web (Blazor Server), ShopFlow.Web.Client (Blazor WASM)
      - ShopFlow.Tests.Unit, ShopFlow.Tests.Integration
    - Verify capstone .csproj files all target net9.0 (per research, they do)
    - Verify CI pipeline (.github/workflows/ci.yml) references .NET 9
    - Lesson content should guide students through building each layer
    - Deployment instructions should be clear and complete

    **6. Add WARNING sections where missing:**
    - Module 22: 3/4 missing. Add warnings about:
      - Over-restrictive policies locking out legitimate users
      - Authorization vs authentication confusion
      - Policy evaluation order
    - Module 23: 3/5 missing. Add warnings about:
      - Secrets in plain text in workflow files
      - Not pinning action versions (supply chain risk)
      - Deployment without rollback strategy
    - Module 24: 5/5 missing. Add warnings about:
      - Capstone scope creep
      - Database migration in production
      - Missing environment-specific configuration
      - Not testing before deploying
      - Connection string security
    - Module 24: 2/5 lessons also missing ANALOGY -- add if natural (don't force)

    **7. Version reference sweep:**
    - All .NET/C# version references should be .NET 9 / C# 13
    - Docker images should reference .NET 9 tags
    - GitHub Actions should use setup-dotnet with 9.0.x

    Commit: "fix(04-04): accuracy pass M20-24 -- Auth/.NET 9, CI/CD, capstone alignment, add WARNINGs"
  </action>
  <verify>
    - Auth patterns use .NET 9 Identity/JWT APIs
    - GitHub Actions workflows reference .NET 9 SDK
    - Docker images reference .NET 9 tags
    - Capstone lesson content matches actual ShopFlow project structure
    - `find content/courses/csharp/modules/22-* -name '*-warning.md' | wc -l` returns at least 3 (new warnings)
    - `find content/courses/csharp/modules/23-* -name '*-warning.md' | wc -l` returns at least 3 (new warnings)
    - `find content/courses/csharp/modules/24-* -name '*-warning.md' | wc -l` returns at least 3 (new warnings)
    - Module 24 capstone references net9.0 consistently
  </verify>
  <done>Modules 20-24 verified. Auth, CI/CD, and capstone content current for .NET 9. WARNING gaps closed in M22, M23, M24. Capstone lessons aligned with ShopFlow project structure.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. All 42 lessons in Modules 16-24 reviewed for accuracy
2. .NET 9 built-in OpenAPI correctly described (Module 19)
3. Aspire 9.x patterns verified (Modules 14, 16)
4. Auth/authz patterns current for .NET 9
5. CI/CD workflows reference .NET 9 SDK and Docker images
6. Capstone lessons match actual ShopFlow project structure
7. WARNING gaps closed in M18, M22, M23, M24
</verification>

<success_criteria>
- CSRP-01 partially satisfied: Modules 16-24 (42/132 lessons) verified against .NET 9
- CSRP-02 partially satisfied: Advanced progression and capstone verified
- CSRP-04 partially assessed: Capstone content matches project structure
- WARNING gaps reduced from 27 to near-zero
</success_criteria>

<output>
After completion, create `.planning/phases/04-csharp-course-audit/04-04-SUMMARY.md`

The SUMMARY must include:
- Count of files modified per module
- Advanced feature corrections (Aspire, AOT, OpenAPI, Auth)
- WARNING sections added per module (count and topics)
- ANALOGY sections added to Module 24 (if any)
- Capstone content-to-project alignment assessment
- CI/CD and Docker version updates
- Any issues deferred to Plan 04-05
</output>
