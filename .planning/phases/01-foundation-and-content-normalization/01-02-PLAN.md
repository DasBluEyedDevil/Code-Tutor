---
phase: 01-foundation-and-content-normalization
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - content/schemas/course.schema.json
  - content/schemas/module.schema.json
  - content/schemas/lesson.schema.json
  - content/schemas/challenge.schema.json
  - content/courses/java/course.json
  - content/courses/java/modules/**/module.json
  - content/courses/java/modules/**/lesson.json
  - content/courses/python/modules/**/module.json
  - content/courses/python/modules/**/lesson.json
  - content/courses/csharp/modules/**/lesson.json
  - content/courses/javascript/course.json
  - content/courses/javascript/modules/**/module.json
  - content/courses/javascript/modules/**/lesson.json
  - content/courses/kotlin/modules/**/module.json
  - content/courses/kotlin/modules/**/lesson.json
  - content/courses/flutter/modules/**/module.json
  - content/courses/flutter/modules/**/lesson.json
autonomous: true

must_haves:
  truths:
    - "A single JSON Schema file exists for each metadata type (course, module, lesson, challenge)"
    - "Every course.json across all 6 courses validates against the shared course schema"
    - "Every module.json across all 6 courses validates against the shared module schema"
    - "Every lesson.json across all 6 courses validates against the shared lesson schema"
    - "All lesson IDs follow the standardized lesson-{MM}-{LL} format"
    - "All module IDs follow the standardized module-{NN} format"
  artifacts:
    - path: "content/schemas/course.schema.json"
      provides: "JSON Schema for course.json validation"
      contains: "schema"
    - path: "content/schemas/module.schema.json"
      provides: "JSON Schema for module.json validation"
      contains: "schema"
    - path: "content/schemas/lesson.schema.json"
      provides: "JSON Schema for lesson.json validation"
      contains: "schema"
    - path: "content/schemas/challenge.schema.json"
      provides: "JSON Schema for challenge.json validation"
      contains: "schema"
  key_links:
    - from: "content/schemas/lesson.schema.json"
      to: "content/courses/**/lesson.json"
      via: "JSON Schema validation"
      pattern: "lesson-\\d{2}-\\d{2}"
    - from: "content/schemas/module.schema.json"
      to: "content/courses/**/module.json"
      via: "JSON Schema validation"
      pattern: "module-\\d{2}"
---

<objective>
Define shared JSON Schemas for all content metadata types (course.json, module.json, lesson.json, challenge.json), then standardize all IDs and validate every JSON file across all 6 courses against those schemas. Auto-fix violations in place.

Purpose: NORM-01 requires all 6 courses use a consistent schema. Currently 6 different AI sessions produced 6 different ID formats, different required fields, and different metadata structures. This plan establishes the single source of truth and forces every file to comply.

Output: 4 JSON Schema files in `content/schemas/`, all 812+ lesson.json files with standardized `lesson-{MM}-{LL}` IDs, all module.json files with standardized `module-{NN}` IDs, all course.json files validated.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-content-normalization/01-CONTEXT.md
@.planning/phases/01-foundation-and-content-normalization/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create JSON Schema files for all content metadata types</name>
  <files>
    content/schemas/course.schema.json
    content/schemas/module.schema.json
    content/schemas/lesson.schema.json
    content/schemas/challenge.schema.json
  </files>
  <action>
    Create `content/schemas/` directory and write 4 JSON Schema files (Draft 2020-12 or 07).

    **course.schema.json** - Required fields: id (string), language (string), title (string), description (string), difficulty (string, enum: ["beginner", "intermediate", "advanced", "beginner-to-advanced"]), estimatedHours (number), prerequisites (array of strings). Optional fields: totalModules (integer), totalLessons (integer), learningOutcomes (array of strings). Allow additional properties to support course-specific fields.

    **module.schema.json** - Required fields: id (string, pattern `^module-\d{2}$`), title (string), description (string), difficulty (string), estimatedHours (number). Optional fields: order (integer). Allow additional properties.

    **lesson.schema.json** - Required fields: id (string, pattern `^lesson-\d{2}-\d{2}$`), title (string), moduleId (string, pattern `^module-\d{2}$`), order (integer, minimum 1), estimatedMinutes (integer, minimum 1), difficulty (string). Optional fields: description (string). Allow additional properties.

    **challenge.schema.json** - Analyze a few existing challenge.json files across courses to determine the common fields. Required fields should include at minimum: title (or name), type, and language. Include testCases as an optional array. Be permissive with additional properties since challenge formats vary more across courses.

    Read several existing JSON files from different courses FIRST to verify the actual field names and types before writing schemas. The schemas must match reality, not assumptions.

    Commit: "feat(01-02): create shared JSON schemas for course content metadata"
  </action>
  <verify>
    - All 4 schema files exist in `content/schemas/`
    - Each schema file is valid JSON
    - Each schema has `$schema` declaration, `type: "object"`, `required` array, and `properties` definitions
    - Pattern constraints on id fields match: module-{NN} and lesson-{MM}-{LL}
  </verify>
  <done>Four JSON Schema files exist in content/schemas/ defining the canonical structure for all content metadata types.</done>
</task>

<task type="auto">
  <name>Task 2: Standardize all IDs and validate all JSON files against schemas</name>
  <files>
    content/courses/**/course.json
    content/courses/**/module.json
    content/courses/**/lesson.json
  </files>
  <action>
    Write and execute a Node.js script (the project already has Node.js) that performs all the following in a single atomic pass per course:

    **Step A: Read every JSON file and log current state**
    - Read all course.json, module.json, lesson.json files across all 6 courses
    - Log the current ID format for each file

    **Step B: Standardize module IDs to `module-{NN}` format**
    - For each course, read all module.json files sorted by directory name (which IS the display order)
    - Set id to `module-{NN}` where NN is the zero-padded sequential number derived from directory sort order
    - Example: Java `01-java-fundamentals/module.json` gets id `module-01`, the 16th module gets `module-16`
    - Write updated module.json back

    **Step C: Standardize lesson IDs to `lesson-{MM}-{LL}` format**
    - For each module, read all lesson.json files sorted by directory name
    - Set id to `lesson-{MM}-{LL}` where MM is the parent module number and LL is the zero-padded sequential lesson number within that module
    - Set moduleId to match the parent module's new standardized id
    - Example: Java Module 01, Lesson 3 gets id `lesson-01-03`, moduleId `module-01`
    - Write updated lesson.json back

    **Step D: Fix course.json difficulty values**
    - Java's `beginner-to-advanced` is valid per schema (it is in the enum)
    - Verify all other course.json difficulty values are in the allowed enum

    **Step E: Validate all files against schemas**
    - Use a Node.js JSON Schema validator (ajv or similar -- install if needed) to validate every JSON file against the corresponding schema
    - Log all validation errors
    - For missing required fields: add sensible defaults (empty string for description, 0 for estimatedMinutes, "beginner" for difficulty)
    - For wrong types: coerce (string "15" to integer 15, etc.)
    - Write fixes back to files

    **Step F: Log all changes**
    - Write a changelog to stdout or a temp file listing every file modified and what changed
    - Format: `{filepath}: {field} changed from {old} to {new}`

    IMPORTANT: Do NOT modify Python Module 14 lesson IDs yet -- that module has duplicate directory prefixes and will be restructured in Plan 04. Assign IDs based on current directory order (duplicates will get sequential IDs like lesson-14-02, lesson-14-03 etc.) and note that Plan 04 will reassign them.

    IMPORTANT: Do NOT rename any directories in this task. Only JSON content is modified. Directory renaming is handled in Plan 03 (numbering gaps).

    Delete the script file after execution (it is a one-time migration tool).

    Commit: "feat(01-02): standardize all content IDs and validate against schemas"
  </action>
  <verify>
    - Run `node -e "const fs=require('fs'); const path=require('path'); ..."` (or a quick verification script) that:
      1. Reads every lesson.json and checks id matches pattern `/^lesson-\d{2}-\d{2}$/`
      2. Reads every module.json and checks id matches pattern `/^module-\d{2}$/`
      3. Reads every lesson.json and checks moduleId matches pattern `/^module-\d{2}$/`
      4. Reports any violations
    - Zero violations reported
    - Run `dotnet test --filter "FullyQualifiedName~ContentValidation"` from the native-app.Tests directory -- note which tests pass and which fail (some may fail due to the old validSectionTypes list or difficulty enum -- that is expected and will be fixed in Plan 03)
  </verify>
  <done>All 812+ lesson.json files have lesson-{MM}-{LL} IDs. All module.json files have module-{NN} IDs. All moduleId references are consistent. Schema validation is run and results logged. Content section type validation failures are expected and will be resolved in Plan 03.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `content/schemas/` contains 4 .schema.json files
2. Every lesson.json `id` matches `lesson-{MM}-{LL}` pattern
3. Every module.json `id` matches `module-{NN}` pattern
4. Every lesson.json `moduleId` references a valid module id that exists in the same course
5. No temporary script files remain in the repository
</verification>

<success_criteria>
- NORM-01 satisfied: All 6 courses use consistent lesson.json schema (standardized id format, required fields, metadata structure)
- JSON Schema files serve as the single source of truth for content structure
- All IDs are self-documenting (encode module and lesson position)
- IDs sort correctly alphabetically
- C# course required zero ID changes (already used lesson-{NN}-{NN} format)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-content-normalization/01-02-SUMMARY.md`
</output>
