<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:challenges="clr-namespace:CodeTutor.Native.Models.Challenges"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="400"
             x:Class="CodeTutor.Native.Controls.CommonMistakesPanel">

  <Border Background="{DynamicResource CardColor}"
          BorderBrush="{DynamicResource CardBorderColor}"
          BorderThickness="1"
          CornerRadius="8"
          Padding="0">

    <Expander Header="{Binding Header}"
              IsExpanded="{Binding IsExpanded}">

      <Expander.Header>
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <!-- Warning Icon -->
          <PathIcon Grid.Column="0"
                    Data="M12 2L2 22h20L12 2zM11 10v6h2v-6h-2zm0 8v2h2v-2h-2z"
                    Width="20"
                    Height="20"
                    Foreground="{DynamicResource WarningColor}"
                    Margin="0,0,8,0"/>

          <!-- Title -->
          <TextBlock Grid.Column="1"
                     Text="{Binding Title}"
                     FontWeight="SemiBold"
                     FontSize="16"
                     VerticalAlignment="Center"
                     Foreground="{DynamicResource PrimaryTextColor}"/>
        </Grid>
      </Expander.Header>

      <StackPanel Spacing="12" Margin="12,8,12,12">

        <!-- Info Message -->
        <Border Background="{DynamicResource InfoBackgroundColor}"
                BorderBrush="{DynamicResource InfoColor}"
                BorderThickness="1"
                CornerRadius="6"
                Padding="12">
          <TextBlock Text="Review these common mistakes to avoid them in your solution."
                     FontSize="13"
                     Foreground="{DynamicResource InfoTextColor}"
                     TextWrapping="Wrap"/>
        </Border>

        <!-- Mistakes List -->
        <ItemsControl ItemsSource="{Binding CommonMistakes}">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="challenges:CommonMistake">
              <Border Background="{DynamicResource SurfaceColor}"
                      BorderBrush="{DynamicResource BorderColor}"
                      BorderThickness="1"
                      CornerRadius="6"
                      Padding="12"
                      Margin="0,0,0,8">

                <StackPanel Spacing="8">

                  <!-- Pattern (Mistake) -->
                  <StackPanel Spacing="4">
                    <TextBlock Text="❌ Mistake:"
                               FontWeight="SemiBold"
                               FontSize="13"
                               Foreground="{DynamicResource ErrorColor}"/>
                    <TextBlock Text="{Binding Pattern}"
                               TextWrapping="Wrap"
                               FontSize="13"
                               Foreground="{DynamicResource PrimaryTextColor}"
                               Margin="16,0,0,0"/>
                  </StackPanel>

                  <!-- Explanation (Consequence) -->
                  <StackPanel Spacing="4">
                    <TextBlock Text="⚠️ Explanation:"
                               FontWeight="SemiBold"
                               FontSize="13"
                               Foreground="{DynamicResource WarningColor}"/>
                    <TextBlock Text="{Binding Explanation}"
                               TextWrapping="Wrap"
                               FontSize="13"
                               Foreground="{DynamicResource SecondaryTextColor}"
                               Margin="16,0,0,0"/>
                  </StackPanel>

                  <!-- Fix (Correction) -->
                  <StackPanel Spacing="4">
                    <TextBlock Text="✅ How to Fix:"
                               FontWeight="SemiBold"
                               FontSize="13"
                               Foreground="{DynamicResource SuccessColor}"/>
                    <TextBlock Text="{Binding Fix}"
                               TextWrapping="Wrap"
                               FontSize="13"
                               Foreground="{DynamicResource PrimaryTextColor}"
                               Margin="16,0,0,0"/>
                  </StackPanel>

                </StackPanel>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

      </StackPanel>

    </Expander>

  </Border>

</UserControl>
