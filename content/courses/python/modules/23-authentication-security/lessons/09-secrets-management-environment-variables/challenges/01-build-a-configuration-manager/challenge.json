{
  "id": "module-21-lesson-09-challenge-1",
  "type": "FREE_CODING",
  "title": "Build a Configuration Manager",
  "description": "Create a type-safe configuration manager for the Finance Tracker that validates settings and supports multiple environments.",
  "instructions": "Complete the ConfigManager class to:\n1. Load configuration from environment variables\n2. Validate required fields and data types\n3. Support environment-specific settings\n4. Mask sensitive values in logs\n5. Provide a clean API for accessing settings",
  "startingCode": "from dataclasses import dataclass, field\nfrom typing import Optional, List, Dict, Any\nimport os\nimport re\n\n@dataclass\nclass SecretValue:\n    \"\"\"Wrapper that hides sensitive values in string representation.\"\"\"\n    _value: str\n    \n    def get_secret_value(self) -> str:\n        return self._value\n    \n    def __repr__(self) -> str:\n        return \"SecretValue('**********')\"\n    \n    def __str__(self) -> str:\n        return \"**********\"\n\nclass ConfigurationError(Exception):\n    \"\"\"Raised when configuration is invalid.\"\"\"\n    pass\n\n@dataclass\nclass DatabaseConfig:\n    url: str\n    pool_size: int = 10\n    pool_timeout: int = 30\n\n@dataclass\nclass SecurityConfig:\n    jwt_secret: SecretValue\n    jwt_algorithm: str = \"HS256\"\n    jwt_expiry_minutes: int = 15\n    allowed_origins: List[str] = field(default_factory=lambda: [\"http://localhost:3000\"])\n\n@dataclass\nclass AppConfig:\n    name: str = \"Finance Tracker\"\n    environment: str = \"development\"\n    debug: bool = False\n\nclass ConfigManager:\n    \"\"\"\n    Configuration manager that loads and validates settings.\n    \"\"\"\n    \n    def __init__(self):\n        self.database: Optional[DatabaseConfig] = None\n        self.security: Optional[SecurityConfig] = None\n        self.app: Optional[AppConfig] = None\n        self._loaded = False\n    \n    def load(self, env_overrides: Optional[Dict[str, str]] = None) -> 'ConfigManager':\n        \"\"\"\n        Load configuration from environment variables.\n        Validates all required settings.\n        \"\"\"\n        env = {**os.environ, **(env_overrides or {})}\n        errors = []\n        \n        # TODO: Load database configuration\n        # Required: DATABASE_URL\n        # Optional: DATABASE_POOL_SIZE (default 10), DATABASE_POOL_TIMEOUT (default 30)\n        try:\n            self.database = self._load_database_config(env)\n        except ConfigurationError as e:\n            errors.append(str(e))\n        \n        # TODO: Load security configuration\n        # Required: JWT_SECRET (min 32 chars)\n        # Optional: JWT_ALGORITHM, JWT_EXPIRY_MINUTES, ALLOWED_ORIGINS (comma-separated)\n        try:\n            self.security = self._load_security_config(env)\n        except ConfigurationError as e:\n            errors.append(str(e))\n        \n        # TODO: Load app configuration\n        # Optional: APP_NAME, ENVIRONMENT, DEBUG\n        self.app = self._load_app_config(env)\n        \n        if errors:\n            raise ConfigurationError(f\"Configuration errors: {'; '.join(errors)}\")\n        \n        self._loaded = True\n        return self\n    \n    def _load_database_config(self, env: Dict[str, str]) -> DatabaseConfig:\n        \"\"\"Load and validate database configuration.\"\"\"\n        # TODO: Get DATABASE_URL (required)\n        # TODO: Validate it looks like a database URL\n        # TODO: Get optional pool settings\n        pass\n    \n    def _load_security_config(self, env: Dict[str, str]) -> SecurityConfig:\n        \"\"\"Load and validate security configuration.\"\"\"\n        # TODO: Get JWT_SECRET (required, min 32 chars)\n        # TODO: Validate JWT_ALGORITHM is valid\n        # TODO: Parse ALLOWED_ORIGINS from comma-separated string\n        pass\n    \n    def _load_app_config(self, env: Dict[str, str]) -> AppConfig:\n        \"\"\"Load application configuration.\"\"\"\n        # TODO: Get optional app settings\n        # TODO: Validate ENVIRONMENT is valid value\n        pass\n    \n    def require_loaded(self) -> None:\n        \"\"\"Ensure configuration is loaded before use.\"\"\"\n        if not self._loaded:\n            raise ConfigurationError(\"Configuration not loaded. Call load() first.\")\n    \n    def summary(self) -> str:\n        \"\"\"Return a safe summary of configuration (no secrets).\"\"\"\n        self.require_loaded()\n        return f\"\"\"\nConfiguration Summary:\n  App: {self.app.name} ({self.app.environment})\n  Debug: {self.app.debug}\n  Database: {self._mask_url(self.database.url)}\n  Pool Size: {self.database.pool_size}\n  JWT Algorithm: {self.security.jwt_algorithm}\n  JWT Expiry: {self.security.jwt_expiry_minutes} minutes\n  Allowed Origins: {self.security.allowed_origins}\n\"\"\"\n    \n    def _mask_url(self, url: str) -> str:\n        \"\"\"Mask password in database URL.\"\"\"\n        return re.sub(r':([^:@]+)@', ':****@', url)\n\n\n# Test the configuration manager\nprint(\"Configuration Manager Test\")\nprint(\"=\" * 50)\n\n# Set up test environment\ntest_env = {\n    \"DATABASE_URL\": \"postgresql://admin:secretpass@localhost:5432/finance\",\n    \"DATABASE_POOL_SIZE\": \"20\",\n    \"JWT_SECRET\": \"this-is-a-very-secure-secret-key-for-jwt-minimum-32\",\n    \"JWT_ALGORITHM\": \"HS256\",\n    \"JWT_EXPIRY_MINUTES\": \"30\",\n    \"ALLOWED_ORIGINS\": \"http://localhost:3000,https://app.example.com\",\n    \"APP_NAME\": \"Finance Tracker Pro\",\n    \"ENVIRONMENT\": \"staging\",\n    \"DEBUG\": \"true\"\n}\n\nconfig = ConfigManager()\ntry:\n    config.load(test_env)\n    print(\"Configuration loaded successfully!\")\n    print(config.summary())\n    \n    # Test secret protection\n    print(f\"JWT Secret (repr): {config.security.jwt_secret}\")\n    print(f\"JWT Secret (actual): {config.security.jwt_secret.get_secret_value()[:10]}...\")\n    \nexcept ConfigurationError as e:\n    print(f\"Configuration Error: {e}\")\n\n# Test validation\nprint(\"\\n--- Validation Tests ---\")\n\n# Missing required field\nprint(\"\\nTest 1: Missing DATABASE_URL\")\ntry:\n    ConfigManager().load({\"JWT_SECRET\": \"a\" * 32})\n    print(\"  FAIL: Should have raised error\")\nexcept ConfigurationError as e:\n    print(f\"  PASS: {e}\")\n\n# JWT secret too short\nprint(\"\\nTest 2: JWT secret too short\")\ntry:\n    ConfigManager().load({\n        \"DATABASE_URL\": \"postgresql://user:pass@localhost/db\",\n        \"JWT_SECRET\": \"short\"\n    })\n    print(\"  FAIL: Should have raised error\")\nexcept ConfigurationError as e:\n    print(f\"  PASS: {e}\")\n\nprint(\"\\nConfiguration manager working correctly!\")",
  "language": "python",
  "testCases": [
    {
      "id": "test-1",
      "description": "Configuration manager loads, validates, and masks secrets correctly",
      "expectedOutput": "Configuration manager working correctly!",
      "isVisible": true
    }
  ],
  "hints": [
    {
      "level": 1,
      "text": "**Hint:** Use `env.get(\"KEY\")` to get optional values and `env.get(\"KEY\", \"default\")` for defaults. Parse comma-separated values with `value.split(\",\")` and strip whitespace with `[x.strip() for x in ...]`. Use regex to validate the database URL format."
    }
  ],
  "commonMistakes": [
    {
      "mistake": "Not validating configuration at startup",
      "consequence": "Runtime errors when code tries to use invalid config",
      "correction": "Load and validate all config at application startup, fail fast"
    },
    {
      "mistake": "Logging secrets in error messages",
      "consequence": "Secrets exposed in log files",
      "correction": "Use SecretValue wrapper and never log sensitive values"
    }
  ],
  "difficulty": "advanced"
}