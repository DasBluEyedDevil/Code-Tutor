---
type: "KEY_POINT"
title: "Database Migration Takeaways"
---

**Core Concepts:**

1. **Never Edit Production Databases Directly**
   - Always use migrations for schema changes
   - `Base.metadata.create_all()` is only for development

2. **Migration Workflow:**
```bash
# 1. Change your models
# 2. Generate migration
alembic revision --autogenerate -m "description"
# 3. Review the migration file!
# 4. Apply migration
alembic upgrade head
```

3. **Key Commands:**
   - `alembic upgrade head` - Apply all migrations
   - `alembic downgrade -1` - Rollback one step
   - `alembic current` - Show current revision
   - `alembic history` - Show all migrations

4. **Always Test Downgrades:**
```bash
alembic upgrade head    # Apply
alembic downgrade -1    # Test rollback
alembic upgrade head    # Re-apply
```

5. **env.py Configuration:**
   - Import ALL models before `target_metadata`
   - Use `async_engine_from_config` for async
   - Set database URL from your app config

**Common Pitfalls:**
- Forgetting to import models (no changes detected)
- Not reviewing autogenerated migrations
- Column renames are detected as drop+add
- Data migrations need manual handling