---
type: "EXAMPLE"
title: "Creating and Running Migrations"
---

**Alembic CLI commands for managing migrations:**

**Workflow:**
1. Make changes to your SQLAlchemy models
2. Run `alembic revision --autogenerate -m "description"`
3. Review the generated migration file
4. Run `alembic upgrade head` to apply

**Always Review Autogenerated Migrations!**
Alembic can detect:
- New tables/columns
- Dropped tables/columns
- Changed column types
- New indexes/constraints

Alembic CANNOT detect:
- Column renames (sees as drop + add)
- Table renames
- Some constraint changes

```python
# === Creating and Running Migrations ===

# STEP 1: Generate migration from model changes
# alembic revision --autogenerate -m "add transactions table"

# This creates a file like:
# migrations/versions/abc123def456_add_transactions_table.py

# STEP 2: Review the migration (ALWAYS DO THIS!)
# Open the file and check upgrade() and downgrade()

# STEP 3: Apply all pending migrations
# alembic upgrade head

# === Other Useful Commands ===

# Show current database revision
# alembic current

# Show migration history
# alembic history

# Show verbose history with dates
# alembic history --verbose

# Upgrade to specific revision
# alembic upgrade abc123

# Downgrade one step
# alembic downgrade -1

# Downgrade to specific revision
# alembic downgrade abc123

# Downgrade all the way (careful!)
# alembic downgrade base

# Show SQL without running (dry run)
# alembic upgrade head --sql

# Create empty migration (for manual edits)
# alembic revision -m "custom data migration"

print("=== Alembic Migration Commands ===")

print("\n--- Creating Migrations ---")
print("alembic revision --autogenerate -m 'message'  # From model changes")
print("alembic revision -m 'message'                 # Empty migration")

print("\n--- Applying Migrations ---")
print("alembic upgrade head      # Apply all pending")
print("alembic upgrade +1        # Apply next one")
print("alembic upgrade abc123    # Upgrade to specific revision")

print("\n--- Rolling Back ---")
print("alembic downgrade -1      # Rollback one step")
print("alembic downgrade abc123  # Rollback to specific revision")
print("alembic downgrade base    # Rollback everything (careful!)")

print("\n--- Inspection ---")
print("alembic current           # Show current revision")
print("alembic history           # Show migration history")
print("alembic heads             # Show latest revisions")
print("alembic show abc123       # Show specific migration")

print("\n--- Dry Run ---")
print("alembic upgrade head --sql   # Show SQL without running")
```
