---
type: "WARNING"
title: "Alembic Migration Pitfalls"
---

**Common Migration Mistakes:**

❌ **Don't edit migration files after applying them**

```bash
# WRONG: Editing applied migration
alembic upgrade head  # Applied revision abc123
# Later: "I'll just fix that column name..."
vim migrations/versions/abc123_add_users.py
alembic upgrade head  # Nothing happens! Already applied!

# RIGHT: Create new migration for changes
alembic revision -m "rename_column"
# Edit the NEW revision file
alembic upgrade head
```

❌ **Don't forget to add migrations to version control**

```bash
# Your migrations are code! Track them:
git add migrations/versions/*.py
git commit -m "Add user table migration"
```

❌ **Don't run autogenerate without reviewing**

```bash
# DANGEROUS: Blindly trusting autogenerate
alembic revision --autogenerate -m "update"
alembic upgrade head  # What did it do?!

# SAFE: Review before applying
alembic revision --autogenerate -m "update"
cat migrations/versions/*_update.py  # Review changes
alembic upgrade head
```

❌ **Don't ignore downgrade functions**

```python
# INCOMPLETE: No way to roll back
def upgrade():
    op.create_table('users', ...)

def downgrade():
    pass  # How do you undo?!

# COMPLETE: Always implement downgrade
def upgrade():
    op.create_table('users', ...)

def downgrade():
    op.drop_table('users')
```

❌ **Don't make data migrations in schema migrations**

```python
# RISKY: Mixing schema and data
def upgrade():
    op.add_column('users', Column('full_name', String))
    # Data migration in schema migration
    op.execute("UPDATE users SET full_name = first_name || ' ' || last_name")

# BETTER: Separate migrations
# 1. Schema migration: add column
# 2. Data migration: populate column
# 3. Schema migration: drop old columns
```

**Alembic Best Practices:**
- [ ] Review autogenerated migrations before applying
- [ ] Always implement downgrade functions
- [ ] Test migrations on copy of production data
- [ ] Keep migrations small and focused
- [ ] Include migrations in code review
