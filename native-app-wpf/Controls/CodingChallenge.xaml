<UserControl x:Class="CodeTutor.Wpf.Controls.CodingChallenge"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
             xmlns:controls="clr-namespace:CodeTutor.Wpf.Controls"
             xmlns:behaviors="clr-namespace:CodeTutor.Wpf.Behaviors">
    <Grid>
        <Border x:Name="ChallengeCard"
                Style="{StaticResource CardBorder}"
                Margin="0,0,0,24"
                behaviors:AnimationBehaviors.EnableFadeInOnLoad="True">
            <StackPanel>
                <!-- Challenge Header -->
                <TextBlock x:Name="ChallengeTitle"
                           Style="{StaticResource SubheadingText}"
                           Margin="0,0,0,8" />
                <TextBlock x:Name="Description"
                           Style="{StaticResource BodyText}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,0,16" />

                <!-- Instructions -->
                <Border Background="{StaticResource BackgroundLightBrush}"
                        CornerRadius="6"
                        Padding="12"
                        Margin="0,0,0,16">
                    <TextBlock x:Name="Instructions"
                               Style="{StaticResource CaptionText}"
                               TextWrapping="Wrap" />
                </Border>

                <!-- Code Editor -->
                <Border x:Name="CodeEditorBorder"
                        Background="#0D1117"
                        BorderBrush="{StaticResource BorderDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        MinHeight="200"
                        Margin="0,0,0,16">
                    <Border.Effect>
                        <DropShadowEffect Direction="270"
                                          ShadowDepth="2"
                                          BlurRadius="8"
                                          Opacity="0.3"
                                          Color="Black" />
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <avalonEdit:TextEditor x:Name="CodeEditor"
                                                Grid.Row="0"
                                                FontFamily="{StaticResource MonoFont}"
                                                FontSize="13"
                                                ShowLineNumbers="True"
                                                Background="Transparent"
                                                Foreground="{StaticResource TextPrimaryBrush}"
                                                LineNumbersForeground="{StaticResource TextMutedBrush}" />

                        <controls:EditorStatusBar x:Name="StatusBar" Grid.Row="1" />
                    </Grid>
                </Border>

                <!-- Action Buttons -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                    <Button Style="{StaticResource PrimaryButton}"
                            Click="RunCode_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Run Code" />
                        </StackPanel>
                    </Button>

                    <Button x:Name="HintButton"
                            Style="{StaticResource SecondaryButton}"
                            Click="ShowHint_Click"
                            Margin="12,0,0,0">
                        <TextBlock Text="Show Hint" />
                    </Button>

                    <Button Style="{StaticResource GhostButton}"
                            Click="ShowSolution_Click"
                            Margin="12,0,0,0">
                        <TextBlock Text="Show Solution" />
                    </Button>

                    <Button Style="{StaticResource GhostButton}"
                            Click="Reset_Click"
                            Margin="12,0,0,0">
                        <TextBlock Text="Reset" />
                    </Button>
                </StackPanel>

                <!-- Output Panel -->
                <Border x:Name="OutputPanel"
                        Background="{StaticResource BackgroundDarkBrush}"
                        BorderBrush="{StaticResource BorderDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Visibility="Collapsed">
                    <StackPanel>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Output"
                                           Style="{StaticResource CaptionText}" />
                                <TextBlock x:Name="RunningIndicator"
                                           Text=" (running...)"
                                           Style="{StaticResource CaptionText}"
                                           Foreground="{StaticResource AccentOrangeBrush}"
                                           Visibility="Collapsed" />
                            </StackPanel>
                            <Button x:Name="StopButton"
                                    Grid.Column="1"
                                    Style="{StaticResource GhostButton}"
                                    Click="StopExecution_Click"
                                    Visibility="Collapsed"
                                    Padding="4,2">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#x25A0; "
                                               Foreground="{StaticResource AccentRedBrush}"
                                               FontSize="10" />
                                    <TextBlock Text="Stop"
                                               Foreground="{StaticResource AccentRedBrush}"
                                               FontSize="11" />
                                </StackPanel>
                            </Button>
                        </Grid>
                        <ScrollViewer MaxHeight="200"
                                      VerticalScrollBarVisibility="Auto">
                            <TextBlock x:Name="OutputText"
                                       Style="{StaticResource CodeText}"
                                       TextWrapping="Wrap" />
                        </ScrollViewer>
                    </StackPanel>
                </Border>

                <!-- Test Results Panel -->
                <Border x:Name="TestResultsPanel"
                        Background="{StaticResource BackgroundDarkBrush}"
                        BorderBrush="{StaticResource BorderDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="0,8,0,0"
                        Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="Test Results:"
                                   Style="{StaticResource CaptionText}"
                                   Margin="0,0,0,8" />
                        <ItemsControl x:Name="TestResultsList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,2,2">
                                        <TextBlock Text="{Binding Status}"
                                                   Foreground="{Binding Color}"
                                                   FontFamily="Segoe UI Symbol"
                                                   Margin="0,0,8,0" />
                                        <TextBlock Text="{Binding Description}"
                                                   Style="{StaticResource CaptionText}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock x:Name="TestSummary"
                                   Style="{StaticResource BodyText}"
                                   Margin="0,8,0,0" />
                    </StackPanel>
                </Border>

                <!-- Hint Panel -->
                <Border x:Name="HintPanel"
                        Background="#1A1F2A"
                        BorderBrush="{StaticResource AccentOrangeBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="0,8,0,0"
                        Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="Hint"
                                   Style="{StaticResource CaptionText}"
                                   Foreground="{StaticResource AccentOrangeBrush}"
                                   Margin="0,0,0,4" />
                        <TextBlock x:Name="HintText"
                                   Style="{StaticResource BodyText}"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <controls:ConfettiOverlay x:Name="ConfettiOverlay"
                                  Visibility="Collapsed"
                                  Panel.ZIndex="2" />
        <controls:AchievementBadge x:Name="AchievementBadge"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Top"
                                   Margin="0,12,12,0"
                                   Panel.ZIndex="3" />
    </Grid>
</UserControl>
