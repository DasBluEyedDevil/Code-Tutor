<UserControl x:Class="CodeTutor.Wpf.Controls.TutorChat"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:CodeTutor.Wpf.Controls"
             Width="380"
             Background="{StaticResource BackgroundDarkBrush}">

    <UserControl.Resources>
        <!-- User message bubble -->
        <Style x:Key="UserMessageStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource AccentBlueBrush}"/>
            <Setter Property="CornerRadius" Value="12,12,4,12"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="40,4,8,4"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="MaxWidth" Value="300"/>
        </Style>

        <!-- Assistant message bubble -->
        <Style x:Key="AssistantMessageStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BackgroundLightBrush}"/>
            <Setter Property="CornerRadius" Value="12,12,12,4"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="8,4,40,4"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="MaxWidth" Value="300"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource BackgroundMediumBrush}"
                Padding="12,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Tutor icon -->
                <Ellipse Grid.Column="0" Width="32" Height="32"
                         Fill="{StaticResource AccentPurpleBrush}" Margin="0,0,10,0"/>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="AI Tutor"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock x:Name="StatusText"
                               Text="Ready to help"
                               FontSize="11"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Close button -->
                <Button Grid.Column="2"
                        x:Name="CloseButton"
                        Content="&#xE8BB;"
                        FontFamily="Segoe MDL2 Assets"
                        FontSize="14"
                        Background="Transparent"
                        Foreground="{StaticResource TextSecondaryBrush}"
                        BorderThickness="0"
                        Padding="8"
                        Cursor="Hand"
                        Click="CloseButton_Click"/>
            </Grid>
        </Border>

        <!-- Loading overlay -->
        <Border x:Name="LoadingOverlay"
                Grid.Row="1"
                Background="{StaticResource BackgroundDarkBrush}"
                Visibility="Collapsed"
                Panel.ZIndex="10">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar x:Name="LoadingProgress"
                             Width="200" Height="4"
                             Minimum="0" Maximum="100"
                             Foreground="{StaticResource AccentBlueBrush}"
                             Background="{StaticResource BackgroundLightBrush}"/>
                <TextBlock Text="Loading AI Tutor..."
                           Margin="0,12,0,0"
                           HorizontalAlignment="Center"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
            </StackPanel>
        </Border>

        <!-- Messages area -->
        <ScrollViewer Grid.Row="1"
                      x:Name="MessagesScrollViewer"
                      VerticalScrollBarVisibility="Auto"
                      Padding="4">
            <ItemsControl x:Name="MessagesPanel">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <controls:ChatMessageBubble Message="{Binding}"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Quick actions -->
        <Border Grid.Row="2"
                Background="{StaticResource BackgroundMediumBrush}"
                Padding="8,6">
            <WrapPanel x:Name="QuickActionsPanel">
                <Button Content="Explain this code"
                        Style="{StaticResource QuickActionButton}"
                        Tag="explain"
                        Click="QuickAction_Click"/>
                <Button Content="Help with error"
                        Style="{StaticResource QuickActionButton}"
                        Tag="error"
                        Click="QuickAction_Click"/>
                <Button Content="Give me a hint"
                        Style="{StaticResource QuickActionButton}"
                        Tag="hint"
                        Click="QuickAction_Click"/>
            </WrapPanel>
        </Border>

        <!-- Input area -->
        <Border Grid.Row="3"
                Background="{StaticResource BackgroundMediumBrush}"
                Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox x:Name="InputTextBox"
                         Grid.Column="0"
                         Padding="12,10"
                         FontSize="13"
                         Background="{StaticResource BackgroundDarkBrush}"
                         Foreground="{StaticResource TextPrimaryBrush}"
                         BorderBrush="{StaticResource BorderDefaultBrush}"
                         BorderThickness="1"
                         AcceptsReturn="False"
                         TextWrapping="Wrap"
                         MaxHeight="80"
                         VerticalScrollBarVisibility="Auto"
                         KeyDown="InputTextBox_KeyDown">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Tag" Value="Ask me anything..."/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <Button x:Name="SendButton"
                        Grid.Column="1"
                        Content="&#xE724;"
                        FontFamily="Segoe MDL2 Assets"
                        FontSize="16"
                        Width="40" Height="40"
                        Margin="8,0,0,0"
                        Background="{StaticResource AccentBlueBrush}"
                        Foreground="White"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="SendButton_Click"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
