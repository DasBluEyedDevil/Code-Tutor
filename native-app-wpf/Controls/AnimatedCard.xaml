<UserControl x:Class="CodeTutor.Wpf.Controls.AnimatedCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="Root"
             Focusable="True"
             CacheMode="BitmapCache">
    <UserControl.Resources>
        <Storyboard x:Key="FocusPulseStoryboard" RepeatBehavior="Forever" AutoReverse="True">
            <DoubleAnimation Storyboard.TargetName="GlowBorder"
                             Storyboard.TargetProperty="Opacity"
                             From="0.2" To="0.6"
                             Duration="0:0:1.2">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="GlowEffect"
                             Storyboard.TargetProperty="BlurRadius"
                             From="8" To="16"
                             Duration="0:0:1.2">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>

    <Grid x:Name="RootGrid"
          Background="Transparent"
          MouseEnter="OnMouseEnter"
          MouseMove="OnMouseMove"
          MouseLeave="OnMouseLeave"
          GotKeyboardFocus="OnGotKeyboardFocus"
          LostKeyboardFocus="OnLostKeyboardFocus"
          MouseLeftButtonDown="OnMouseLeftButtonDown">
        <Grid.Effect>
            <DropShadowEffect x:Name="DepthShadow"
                              Color="#000000"
                              BlurRadius="12"
                              ShadowDepth="2"
                              Opacity="0.35" />
        </Grid.Effect>

        <Viewport3D x:Name="CardViewport">
            <Viewport3D.Camera>
                <PerspectiveCamera Position="0,0,2.4"
                                   LookDirection="0,0,-2.4"
                                   FieldOfView="50" />
            </Viewport3D.Camera>

            <ModelVisual3D>
                <DirectionalLight Color="#FFFFFF" Direction="-0.2,-0.4,-1" />
            </ModelVisual3D>

            <Viewport2DVisual3D x:Name="CardSurface">
                <Viewport2DVisual3D.Geometry>
                    <MeshGeometry3D Positions="-0.5,-0.5,0 0.5,-0.5,0 0.5,0.5,0 -0.5,0.5,0"
                                    TextureCoordinates="0,1 1,1 1,0 0,0"
                                    TriangleIndices="0 1 2 0 2 3" />
                </Viewport2DVisual3D.Geometry>
                <Viewport2DVisual3D.Material>
                    <DiffuseMaterial Viewport2DVisual3D.IsVisualHostMaterial="True" Brush="White" />
                </Viewport2DVisual3D.Material>
                <Viewport2DVisual3D.Transform>
                    <Transform3DGroup>
                        <RotateTransform3D>
                            <RotateTransform3D.Rotation>
                                <AxisAngleRotation3D x:Name="TiltRotationX" Axis="1,0,0" Angle="0" />
                            </RotateTransform3D.Rotation>
                        </RotateTransform3D>
                        <RotateTransform3D>
                            <RotateTransform3D.Rotation>
                                <AxisAngleRotation3D x:Name="TiltRotationY" Axis="0,1,0" Angle="0" />
                            </RotateTransform3D.Rotation>
                        </RotateTransform3D>
                    </Transform3DGroup>
                </Viewport2DVisual3D.Transform>
                <Viewport2DVisual3D.Visual>
                    <Border x:Name="CardBorder"
                            Background="{StaticResource BackgroundMediumBrush}"
                            BorderBrush="{StaticResource BorderDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="10"
                            Padding="20"
                            ClipToBounds="True">
                        <Grid>
                            <ContentPresenter Content="{Binding CardContent, RelativeSource={RelativeSource AncestorType=UserControl}}" />

                            <Border x:Name="ShineOverlay" Opacity="0" IsHitTestVisible="False">
                                <Border.Background>
                                    <RadialGradientBrush x:Name="ShineBrush"
                                                         Center="0.5,0.5"
                                                         GradientOrigin="0.5,0.5"
                                                         RadiusX="0.8"
                                                         RadiusY="0.8">
                                        <GradientStop Color="#33FFFFFF" Offset="0" />
                                        <GradientStop Color="#00FFFFFF" Offset="1" />
                                    </RadialGradientBrush>
                                </Border.Background>
                            </Border>

                            <Border x:Name="GlowBorder"
                                    BorderBrush="{StaticResource AccentBlueBrush}"
                                    BorderThickness="1.5"
                                    CornerRadius="10"
                                    Opacity="0"
                                    IsHitTestVisible="False">
                                <Border.Effect>
                                    <DropShadowEffect x:Name="GlowEffect"
                                                      Color="{StaticResource AccentBlue}"
                                                      BlurRadius="8"
                                                      ShadowDepth="0"
                                                      Opacity="0.6" />
                                </Border.Effect>
                            </Border>
                        </Grid>
                    </Border>
                </Viewport2DVisual3D.Visual>
            </Viewport2DVisual3D>
        </Viewport3D>
    </Grid>
</UserControl>
